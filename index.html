<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVD Staff Dashboard</title>
    <link rel="stylesheet" href="dashboard-logic.js">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="margin-bottom:20px; color:#334155;">Staff Portal</h2>
            <input type="email" id="e-email" class="login-input" placeholder="Employee Email">
            <input type="password" id="e-pass" class="login-input" placeholder="Password">
            <button onclick="empLogin()" style="width:100%; padding:12px; background:#0891b2; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">Login System</button>
            <p id="login-error" style="color:red; margin-top:10px; font-size:12px;"></p>
        </div>
    </div>

    <div id="incoming-call-modal"></div>

    <div class="ribbon-container">
        <div style="background:#ef4444; padding:0 15px; height:100%; display:flex; align-items:center; font-weight:bold; font-size:12px;">DEADLINES</div>
        <div class="ribbon-track" id="ribbon-track"></div>
    </div>

    <div class="dashboard-grid">
        
        <div class="sidebar">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search UID (Enter)">
            </div>

            <div class="section-title">Missed / Unattended</div>
            <div class="queue-list" id="queue-missed" style="max-height:150px; border-bottom:1px solid #e2e8f0;"></div>

            <div class="section-title">My Active Chats (Max 2)</div>
            <div class="queue-list" id="queue-active" style="flex:0.6; border-bottom:1px solid #e2e8f0;"></div>

            <div class="section-title">Waiting Queue</div>
            <div class="queue-list" id="queue-waiting" style="flex:1;"></div>
        </div>

        <div class="chat-area">
            <div class="chat-header">
                <span id="header-title" style="font-weight:700; color:#334155;">Select a Chat</span>
                <div class="chat-actions">
                    <button class="btn-call" title="Start WebRTC">ðŸ“ž Voice Call</button>
                    <button class="btn-end" onclick="closeActiveChat()">End Session</button>
                </div>
            </div>
            <div class="messages-container" id="msg-area">
                <div style="text-align:center; color:#94a3b8; margin-top:50px;">
                    Select a client from the queue to start.
                </div>
            </div>
            <div class="input-zone">
                <input type="text" id="emp-input" placeholder="Type message..." style="flex:1; padding:10px; border:1px solid #cbd5e1; border-radius:6px; outline:none;">
                <button onclick="sendEmpMessage()" style="padding:10px 20px; background:#0891b2; color:white; border:none; border-radius:6px; cursor:pointer;">Send</button>
            </div>
        </div>

        <div class="details-panel">
            <h3 style="margin-bottom:20px; color:#334155;">Client Records</h3>
            
            <div class="field-group">
                <label class="field-label">Passport Number</label>
                <input type="text" id="inp-passport" class="secure-input" placeholder="Z1234567">
            </div>

            <div class="field-group">
                <label class="field-label">Application ID</label>
                <input type="text" id="inp-appid" class="secure-input" placeholder="V99887766">
            </div>

            <div class="field-group">
                <label class="field-label">Notes & Promises</label>
                <textarea id="inp-notes" class="notes-box" placeholder="Internal notes..."></textarea>
            </div>

            <div class="field-group">
                <label class="field-label">Set Deadline (Ribbon)</label>
                <input type="datetime-local" id="inp-deadline" class="secure-input">
            </div>

            <button onclick="saveSecureDetails()" style="width:100%; padding:12px; background:#22c55e; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; margin-top:10px;">Save Changes</button>
        </div>

    </div>

    <script src="config.js"></script>
    <script src="dashboard-logic.js"></script>
</body>
</html>
